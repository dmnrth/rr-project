---
title: 01 Downloading data
date: 2024-05-12
---

Loading required packages

```{r}
packages <- c("moments", "quantmod", "xts", "DT", 'tidyverse')

for (package in packages) {
  if (!require(package, character.only = TRUE)) {
    install.packages(package)
    library(package, character.only = TRUE)
  }
}
```

Downloading S&P500 data

```{r}
start_date <- "2000-01-01"
end_date <- "2020-01-01"

sp500 <- getSymbols("^GSPC",
                    from = start_date,
                    to = end_date,
                    env = NULL)
sp500 <- sp500["2000-01-01/2019-12-30"]
sp500_prices <- sp500$GSPC.Adjusted
sp500_log_returns <- log(sp500$GSPC.Adjusted / lag(sp500$GSPC.Adjusted))
sp500_simple_returns <- (sp500$GSPC.Adjusted / lag(sp500$GSPC.Adjusted) - 1)
```

Calculating descriptive statistics

```{r}
price_stats = tibble(SP500_prices_adj = as.numeric(sp500_prices)) %>% 
  summarise(Min = min(SP500_prices_adj),
            Quartile_1st = quantile(SP500_prices_adj,0.25),
            Median = median(SP500_prices_adj),
            Mean = mean(SP500_prices_adj),
            Quartile_3rd = quantile(SP500_prices_adj,0.75),
            Max = max(SP500_prices_adj),
            Skew = skewness(SP500_prices_adj),
            Kurtosis = kurtosis(SP500_prices_adj) - 3,
            Standard_error = sd(SP500_prices_adj)/sqrt(length(SP500_prices_adj)),
            Standard_deviation = sd(SP500_prices_adj)
            )

ret_stats = tibble(SP500_Log_Returns = as.numeric(sp500_log_returns)) %>% 
  na.omit() %>% 
  summarise(Min = min(SP500_Log_Returns),
            Quartile_1st = quantile(SP500_Log_Returns,0.25),
            Median = median(SP500_Log_Returns),
            Mean = mean(SP500_Log_Returns),
            Quartile_3rd = quantile(SP500_Log_Returns,0.75),
            Max = max(SP500_Log_Returns),
            Skew = skewness(SP500_Log_Returns),
            Kurtosis = kurtosis(SP500_Log_Returns) - 3,
            Standard_error = sd(SP500_Log_Returns)/sqrt(length(SP500_Log_Returns)),
            Standard_deviation = sd(SP500_Log_Returns)
            )

tibble(statistic = colnames(ret_stats), SP500_prices_adj = round(as.numeric(price_stats),4), SP500_Log_Returns = round(as.numeric(ret_stats),4)) %>% 
  datatable() %>% 
  formatRound(columns = c('SP500_prices_adj','SP500_Log_Returns'), digits = 4)
```

Saving data and deleting unnecessary objects

#todo create plots

```{r}
saveRDS(sp500_prices,
        file = "input/sp500_prices.rds")

rm(list = ls())
```
